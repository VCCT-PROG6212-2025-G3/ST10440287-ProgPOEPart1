@* Views/Home/SubmitClaim.cshtml - Submit Claim View *@
@model ProgPOE.ViewModels.SubmitClaimViewModel
@{
    ViewData["Title"] = "Submit Claim";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row">
    <div class="col-md-8">
        <h2>📝 Submit Monthly Claim</h2>
        <p class="text-muted">Complete the form below to submit your monthly claim for review</p>

        <form asp-action="SubmitClaim" method="post" enctype="multipart/form-data" id="claimForm">
            <div class="card">
                <div class="card-header">
                    <h5>📋 Claim Information</h5>
                </div>
                <div class="card-body">
                    <!-- Claim Period -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label asp-for="MonthYear" class="form-label">Claim Period (YYYY-MM):</label>
                            <input asp-for="MonthYear" class="form-control" type="month" />
                            <span asp-validation-for="MonthYear" class="text-danger"></span>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Department:</label>
                            <select class="form-control" disabled>
                                <option>Computer Science</option>
                            </select>
                            <small class="text-muted">Based on your user profile</small>
                        </div>
                    </div>

                    <!-- Hours and Rate -->
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label asp-for="HoursWorked" class="form-label">Hours Worked:</label>
                            <input asp-for="HoursWorked" class="form-control" type="number" step="0.1"
                                   placeholder="0.0" onchange="calculateTotal()" />
                            <span asp-validation-for="HoursWorked" class="text-danger"></span>
                        </div>
                        <div class="col-md-4">
                            <label asp-for="HourlyRate" class="form-label">Hourly Rate (R):</label>
                            <input asp-for="HourlyRate" class="form-control" type="number" step="0.01"
                                   placeholder="450.00" onchange="calculateTotal()" />
                            <span asp-validation-for="HourlyRate" class="text-danger"></span>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Total Amount:</label>
                            <div class="form-control bg-light" id="totalAmount" style="font-weight: bold; color: #28a745;">
                                R 0.00
                            </div>
                        </div>
                    </div>

                    <!-- Additional Notes -->
                    <div class="mb-3">
                        <label asp-for="Notes" class="form-label">Additional Notes (Optional):</label>
                        <textarea asp-for="Notes" class="form-control" rows="3"
                                  placeholder="Any additional information about your claim..."></textarea>
                        <span asp-validation-for="Notes" class="text-danger"></span>
                    </div>
                </div>
            </div>

            <!-- Document Upload Section -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5>📎 Supporting Documents</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Upload Supporting Documents:</label>
                        <input type="file" class="form-control" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
                               onchange="handleFileSelect(this)" />
                        <small class="text-muted">
                            Accepted formats: PDF, DOC, DOCX, JPG, PNG | Maximum size: 10MB per file
                        </small>
                    </div>

                    <!-- File Preview -->
                    <div id="filePreview" class="mt-3" style="display: none;">
                        <h6>📁 Selected Files:</h6>
                        <div id="fileList" class="list-group">
                            <!-- Files will be listed here -->
                        </div>
                    </div>

                    <!-- Sample Documents Display -->
                    <div class="mt-3">
                        <h6>📄 Sample Documents (Visual Prototype):</h6>
                        <div class="list-group">
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                📕 timesheet_april_2024.pdf
                                <span class="badge bg-primary">245 KB</span>
                            </div>
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                📊 attendance_record.xlsx
                                <span class="badge bg-success">156 KB</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="card mt-4">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-12">
                            <button type="submit" class="btn btn-success btn-lg me-3">
                                ✅ Submit Claim
                            </button>
                            <button type="button" class="btn btn-secondary btn-lg me-3" onclick="saveDraft()">
                                💾 Save as Draft
                            </button>
                            <a href="@Url.Action("Dashboard", "Home")" class="btn btn-outline-danger btn-lg">
                                ❌ Cancel
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <!-- Sidebar with Information -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5>ℹ️ Claim Submission Guidelines</h5>
            </div>
            <div class="card-body">
                <h6>📋 Required Information:</h6>
                <ul>
                    <li>Accurate hours worked</li>
                    <li>Correct hourly rate</li>
                    <li>At least one supporting document</li>
                </ul>

                <h6>📎 Document Requirements:</h6>
                <ul>
                    <li>Timesheet (PDF preferred)</li>
                    <li>Attendance records</li>
                    <li>Class schedules</li>
                    <li>Any relevant correspondence</li>
                </ul>

                <h6>⏰ Processing Timeline:</h6>
                <ul>
                    <li><strong>Step 1:</strong> Coordinator Review (3-5 days)</li>
                    <li><strong>Step 2:</strong> Manager Approval (2-3 days)</li>
                    <li><strong>Step 3:</strong> Payment Processing (5-7 days)</li>
                </ul>

                <div class="alert alert-info">
                    <strong>💡 Tip:</strong> Submit claims by the 5th of each month for faster processing.
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function calculateTotal() {
        const hours = parseFloat(document.querySelector('[name="HoursWorked"]').value) || 0;
        const rate = parseFloat(document.querySelector('[name="HourlyRate"]').value) || 0;
        const total = hours * rate;
        document.getElementById('totalAmount').textContent = 'R ' + total.toLocaleString('en-ZA', {minimumFractionDigits: 2});
    }

    function handleFileSelect(input) {
        const files = input.files;
        const filePreview = document.getElementById('filePreview');
        const fileList = document.getElementById('fileList');

        if (files.length > 0) {
            filePreview.style.display = 'block';
            fileList.innerHTML = '';

            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const fileSize = (file.size / 1024).toFixed(1) + ' KB';
                const fileIcon = getFileIcon(file.name);

                const listItem = document.createElement('div');
                listItem.className = 'list-group-item d-flex justify-content-between align-items-center';
                listItem.innerHTML = `
                    ${fileIcon} ${file.name}
                    <span class="badge bg-info">${fileSize}</span>
                `;
                fileList.appendChild(listItem);
            }
        } else {
            filePreview.style.display = 'none';
        }
    }

    function getFileIcon(filename) {
        const extension = filename.split('.').pop().toLowerCase();
        switch(extension) {
            case 'pdf': return '📕';
            case 'doc':
            case 'docx': return '📘';
            case 'jpg':
            case 'jpeg':
            case 'png': return '🖼️';
            default: return '📄';
        }
    }

    function saveDraft() {
        alert('💾 Save as Draft\n\nThis would save your current progress and allow you to complete the claim later.\n\n⚠️ Visual Prototype Only - No actual saving occurs.');
    }

    // Calculate total on page load if values are present
    document.addEventListener('DOMContentLoaded', function() {
        calculateTotal();
    });
</script>
